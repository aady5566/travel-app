{
  "rules": {
    "trips": {
      "$tripId": {
        // Only authenticated users can read/write
        ".read": "auth != null",
        ".write": "auth != null",

        "dates": {
          ".validate": "newData.hasChildren()",
          "$dateId": {
            ".validate": "newData.isString() && newData.val().matches(/^\\d{4}-\\d{2}-\\d{2}$/)"
          }
        },

        "activities": {
          "$activityId": {
            ".validate": "newData.hasChild('title') && newData.hasChild('date')",
            "title": { ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200" },
            "date": { ".validate": "newData.isString() && newData.val().matches(/^\\d{4}-\\d{2}-\\d{2}$/)" },
            "time": { ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 10)" },
            "category": { ".validate": "!newData.exists() || newData.isString()" },
            "location": { ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)" },
            "lat": { ".validate": "!newData.exists() || newData.isNumber()" },
            "lng": { ".validate": "!newData.exists() || newData.isNumber()" },
            "notes": { ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 1000)" },
            "updatedAt": { ".validate": "newData.isNumber()" }
          }
        },

        "expenses": {
          "$expenseId": {
            ".validate": "newData.hasChild('amount') && newData.hasChild('description') && newData.hasChild('payer')",
            "amount": { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000000" },
            "description": { ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200" },
            "category": { ".validate": "!newData.exists() || newData.isString()" },
            "payer": { ".validate": "newData.isString() && newData.val().length > 0" },
            "splitBetween": { ".validate": "newData.hasChildren()" },
            "date": { ".validate": "newData.isString()" },
            "createdAt": { ".validate": "newData.isNumber()" }
          }
        },

        "members": {
          "$memberId": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
          }
        }
      }
    }
  }
}
